import{log,LOG_TYPE}from"./logger.js";import*as Sfx from"./sfx.js";import{initCache,buildMenuData,handleKey,handleResize,showPicker,navPicker,enterPicker,cleanupElements,createGameDisplay,}from"./menu.js";import{setupFileInput,setupDragDrop,loadSwf}from"./game.js";export const DIR={Left:-1,Right:1,Up:1,Down:-1,};export const TRANSITION_MS=1000;export const H_MOVE_PCT=0.155;export const V_MOVE_VH=19.4;export const V_OFFSET_VH=16.5;export const RESIZE_DEBOUNCE_MS=250;export const cache={menuItems:null,mainContainer:null,statusBar:null,systemPickerOverlay:null,systemPicker:null,systemsWrapper:null,systemsContainer:null,gameFileInput:null,activeMenuDisplay:null,activeSubMenuDisplay:null,};export const state={hTransitioning:false,vTransitioning:false,statusVisible:false,activeMenuIdx:0,menuData:[],actionQueue:[],processing:false,picker:{active:false,items:[],activeIdx:0,},};export const eventHandlers={dragHandlers:null,resizeHandler:null,keyHandler:null,};export const getActiveMenu=()=>state.menuData[state.activeMenuIdx];const cleanup=()=>{if(eventHandlers.keyHandler){document.body.removeEventListener("keydown",eventHandlers.keyHandler);}
if(eventHandlers.resizeHandler){window.removeEventListener("resize",eventHandlers.resizeHandler);}
if(eventHandlers.dragHandlers){const events=["dragenter","dragover","dragleave","drop"];const handlers=eventHandlers.dragHandlers;events.forEach((evt)=>{document.removeEventListener(evt,handlers.prevent);cache.mainContainer?.removeEventListener(evt,handlers.prevent);});document.removeEventListener("dragenter",handlers.dragenter);document.removeEventListener("dragleave",handlers.dragleave);document.removeEventListener("drop",handlers.drop);cache.mainContainer?.removeEventListener("drop",handlers.drop);}};initCache();buildMenuData();eventHandlers.keyHandler=handleKey;eventHandlers.resizeHandler=handleResize;document.body.addEventListener("keydown",eventHandlers.keyHandler);window.addEventListener("resize",eventHandlers.resizeHandler);if(cache.menuItems.length>0){cache.menuItems[0].classList.add("active-menu-item");}
cache.menuItems.forEach((el)=>{const container=el.querySelector(".sub-menu-item-container");if(container?.children.length){container.children[0].classList.add("active-sub-menu-item");}});setupFileInput();setupDragDrop();Object.assign(window,{showSystemPicker:showPicker,handleSystemPickerNavigation:navPicker,handleSystemPickerEnter:enterPicker,loadSwfWithRuffle:loadSwf,cleanupOldElements:cleanupElements,hideMenu:()=>cache.mainContainer&&(cache.mainContainer.style.display="none"),createGameDisplay,cleanupMenuSystem:cleanup,});